#include "../src/include/regdef.h"
#include "../src/include/mipsregs.h"

#define FLAG 0xbfc016e0
#define IO_PORT 0xb40003F8
#define IO_PORT_READY 0xb40003fd
#define UART_LSR_DR   0x01
#define UART_LSR_THRE 0x20

.section .text
.set mips2
.set noreorder
.global __start

.set	nomips16
.set	nomicromips
.set	noreorder

__start:
    la t0,0x400004
    mtc0 t0,CP0_STATUS
    nop
    la v0, FLAG
loop:
    lb a0,(v0)
    beqz a0,done
    nop

    la t0, IO_PORT_READY
restart:
    lb t1, (t0)
    and t1,UART_LSR_THRE
    beqz t1,restart
    nop
    la t0, IO_PORT
    sb a0,(t0)
    nop
    add v0,v0,1

    b loop
    nop

done:
    b . 
    nop



